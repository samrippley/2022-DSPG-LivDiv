---
title: "Demographics Analysis (Taj)"
author: "Taj Cole"
date: '2022-06-22'
output: html_document
---

### Variables:Land owned, land fallowed, households with a business, type of business, business income, job durtation, households below the poverty line, household size  

```{r, include=FALSE}
### Packages
library(dplyr)
library(ggplot2)
library(plotrix)
library(viridis)
```


```{r, include=FALSE}
### Load data and set baseline
load("~/2022-DSPG-LivDiv-/data/livdivdata.RData")
baseline <- livdiv %>%
  slice(1:306)

selected_bl <- baseline %>% select(hh_ownfarm_prop, hh_ownfarm, nb_hhmem, land_own, business_yn, business_type, below_204inr_bl, village, today, hhid)

business_bl <- baseline %>% 
  select(hhid, village, business_yn, business_type, business_asset, business_mth, business_inc)

```


# *Land Owned*

a bar plot that shows the different amount of 'kathas' of land owned and how many households owned that amount, aggregated from every village

```{r}
# Bar plot of Kathas owned across all 10 villages
own_land <- ggplot(selected_bl, aes(x = land_own, fill = village, color = village)) + 
  geom_bar(position = position_dodge(2)) +
  labs(x = "'Land Owned [Kathas]", y = " Number of Households") + 
  theme_classic() +
  ggtitle("Land Owned Across All Villages")
own_land
```

-   A katha is about 1,361 sq ft. For reference, 1 acre is about 32 kathas
-   Households in the baseline own an average of 48.36 kathas of land
-   The max owned is 510 kathas (1 person in Bijoynagar)
-   The min owned is 1 kathas
-   106 NAs were reported and removed from histogram
-   (Only asked households that reported to own a farm)
-   Most households that own farm land own less than 100 kathas which is about 3 acres
-   A majority of households that own less than 100 kathas are cattle farms and less agriculture
-   Most households provide labor to farm land, rather than owning their own farm land


```{r, include=FALSE}
### New data frame with the villages, amount of land owners, and max, min, and average land owned in the sample
villages <- c("Amrabati","Beguakhali","Bijoynagar","Birajnagar","Haridaskati Samsernagar","Lakshmi Janardanpur","Pargumti","Purba Dwarokapur","Sagar","Shibpur") 
land_owners <- c(2, 18, 41, 14, 25, 21, 24, 21, 10, 24)
max_land_value <- c(16, 160, 510, 80, 120, 200, 250, 70, 80, 180 )
min_land_value <- c(10, 10, 8, 10, 1, 10, 3, 7, 2, 3)
mean_land_value <- c(13, 45.44, 60.95, 42.14, 45.44, 50.9, 64, 36.35, 23.7, 41.58)
sum_value <- c(26, 818, 2499, 590, 1136, 1069, 1537, 763.5, 237, 998)
land_stats <- data.frame(villages, land_owners, max_land_value, min_land_value, mean_land_value, sum_value)
land_stats

```

### Average Kathas Owned Plot

```{r}
# Mean land owned
mean_land_plot <- ggplot(land_stats, aes(x = villages, y = mean_land_value, fill = villages)) +
  geom_col(fill = plasma(10, alpha = 1, begin = 0, end = 1, direction = 1)) +
  coord_flip() +
  ggtitle("Average Amount of Land Owned in Each Village") +
  labs(x = "", y = "Land Owned [Kathas]")
mean_land_plot

```

- This graph shows the average amount of land that households own in each village
- Most villages had households that owned an average of 40 kathas of land, which i a little more than 1 acre


# *Land Fallowed*

```{r, include=FALSE}
land_fallow <- baseline %>% 
  select(village, land_fallow)
land_fallow <- land_fallow %>% 
  group_by(village) %>% 
  summarise("avg" = mean(na.omit(land_fallow)), "sum" = sum(na.omit(land_fallow)))
```

```{r}
land_fallow_plot <- ggplot(land_fallow, aes(x = village, y = sum, fill = village)) +
  geom_col(fill = plasma(10, alpha = 1, begin = 0, end = 1, direction = 1))+
  theme_classic() +
  labs(x = "", y = "Total Land fallowed")+
  coord_flip()
land_fallow_plot
```

- fallow: (of farmland) plowed and harrowed but left unsown for a period in order to restore its fertility as part of a crop rotation or to avoid surplus production
- this graph shows the total amount of land fallowed in each village (within the sample)
- 3 villages had no land fallowed 
- Villages that have a larger average of kathas of land owned had more land fallowed


# *Business Demographics*

## Households that own a business across all villages

```{r}
# Pie chart have Households that own a business (aggregate)
slices <- c(268, 38)
lbls <- c("No", "               Yes")
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels
lbls <- paste(lbls,"%      ",sep="") # ad % to labels
business_pie <- pie3D(slices,labels = lbls, col=rainbow(length(lbls)),
    main="Households that own a Business (All Villages)")
```

- This pie chart shows the distribution of households that own a business across all 10 villages
-   88% of households across the 10 villages reported that they do not own a business
-   12% do own a business

## Households that own a business by village
### Data Set
```{r, include=FALSE}

# Business counts
villages_2 <- c(rep("Amrabati", 2), rep("Beguakhali", 2), rep("Bijoynagar", 2), rep("Birajnagar", 2), rep("Haridaskati Samsernagar", 2), rep("Lakshmi Janardanpur",2), rep("Pargumti",2),rep("Purba Dwarokapur", 2), rep("Sagar", 2), rep("Shibpur",2))
Key <- rep(c("No", "Yes"), 2)
values_bus <-c(26,2,27,3,48,2,24,2,27,3,25,3,24,4,21,7,21,7,25,3)
#prop_bus_values <- c(0.93,0.07, 0.9,0.1,0.96,0.04,0.86,0.14,0.9,0.1,0.9,0.1,0.86,0.14,0.75,0.25,0.75,0.25,0.9,0.1)
prop_bus_values <- c("93%","7%","90%","10%","96%","4%","86%","14%","90%","10%","90%","10%","86%","14%","75%","25%","75%","25%","90%","10%")
dat_bus <-  data.frame(villages_2, Key, values_bus, prop_bus_values)
dat_bus
# Poverty line counts
values_pl <- c(17,11,20,10,32,18,19,9,14,16,17,11,18,10,23,5,21,6,21,7)
prop_pl_values <- c("60%", "40%", "67%", "33%", "64%","36%","68%","32%","53%","                47%","60%","40%","64%","36%","82%","18%","77%","23%","75%","25%" )
dat_pl <- data.frame(villages_2, Key, values_pl, prop_pl_values)
dat_pl
```

### Business stacked plot
```{r}
# Business stacked plot

village_bus_count_plot <- ggplot(dat_bus, aes(x= villages_2, y = values_bus, fill = Key)) + 
  geom_col(position = 'stack') + 
  labs( x= "", y = "Total Number of Households") + 
  theme_classic() + 
  ggtitle("Households That Own a Business") +
  coord_flip()+
  geom_text(aes(label = prop_bus_values), size = 2.5, nudge_y = -1)
village_bus_count_plot
```

-   Across all 10 villages, very few households own a business. Purba Dwarokapur and Sagar had the most, with 7 households within the sample reporting to own a business.
-   Its not surprising to see that most households do not own a business.Since the region is largely in poverty, it would not be feasible for most households, as operating a business requires consistent injections of money and managing financial risk (debt, shocks)
-   Rather than owning a business, most members of the household may provide labor for farms and the few businesses in the villages.


## Type of Business Across All Villages

```{r}
slices_bt <- c(2,2,1,1,1,11,2,12,1,2,1,1,1)
lbls_bt <- c("                     Barber/Saloon", "            Clothier", "               Decorator", "            Electronic Shop", "Fish Monger",
             "Grocery/Corner Shop", "Hotel/Guest House", "Petty Trader", "       Poultry Seller",
             "                       Seashell Seller", "          Studio", "                   Sugar Seller", "                Tea Supplier")
pct_bt <- round(slices_bt/sum(slices_bt)*100)
lbls_bt <- paste(lbls_bt, pct_bt) # add percents to labels
lbls_bt <- paste(lbls_bt,"%            ",sep="") # add % to labels
business_type_pie <- pie3D(slices_bt,labels = lbls_bt, col=rainbow(length(lbls_bt)),
                      main="Type of Business (All Villages)", 
                      labelcex = 0.6)
```

- This pie chart shows the distribution of the types of businesses owned across all 10 villages
- Most households that own a business are petty traders or own a grocery/corner shop
- The qualifications for owning a business are quite wide, ex. someone that catches and sells fish is considered to be a buisness owner


## Average Business Income in a typical month by village

```{r}
bus_inc <- business_bl %>% 
  select(village, business_inc) %>% 
  group_by(village) %>% 
  summarise("avg" = mean(na.omit(business_inc)))

avg_bus_inc <- ggplot(bus_inc, aes(x = village, y = avg, fill = village)) +
  geom_col(fill = plasma(10, alpha = 1, begin = 0, end = 1, direction = 1))+
  theme_classic()+
  coord_flip()+
  labs(x = "", y = "Average Business Income [Rupee]") +
  ggtitle('Average Business Income in a Typical Month')+
  scale_color_brewer(palette = "Spectral")
avg_bus_inc
```

- This graph shows the average amount of profit a business earned in a typical month
- A "typical month" was included in the financial diary, i'm assuming this means without any sort of shock 

# *Job Duration* 
```{r, include=FALSE}
job_duration <- baseline %>% 
  select(village, relationship1, relationship2, relationship3, relationship4,
         job1_duration1, job1_duration2, job1_duration3,
         job1_duration4, job1_duration5, job1_duration6, 
         job1_duration7, job1_duration9, job1_duration12)
amrabati_job_duration <- job_duration %>% 
  filter(village == "Amrabati") %>% 
  select(-c(relationship2, relationship3,relationship3, relationship4, job1_duration2, job1_duration3,
            job1_duration4, job1_duration5, job1_duration6, 
            job1_duration7, job1_duration9, job1_duration12)) 
amrabati_job_duration_summary <- amrabati_job_duration %>% 
  summarise("avg job duration" = mean(na.omit(job1_duration1 )))

beguakhali_job_duration <- job_duration %>% 
  filter(village == "Beguakhali") %>% 
  select(-c(relationship3, relationship4, job1_duration3,
            job1_duration4, job1_duration5, job1_duration6, 
            job1_duration7, job1_duration9, job1_duration12))
beguakhali_job_duration_summary <- beguakhali_job_duration %>% 
  summarise("avg job duration" = mean(na.omit(job1_duration1)))

bijoynagar_job_duration <- job_duration %>% 
  filter(village == "Bijoynagar") %>% 
  select(-c(relationship3, relationship4, job1_duration3,
            job1_duration4, job1_duration5, job1_duration6, 
            job1_duration7, job1_duration9, job1_duration12))
bijoynagar_job_duration_summary <- bijoynagar_job_duration %>% 
  summarise("avg job duration" = mean(na.omit(job1_duration1)))

birajnagar_job_duration <- job_duration %>% 
  filter(village == "Birajnagar") %>% 
  select(-c(relationship4,
            job1_duration4, job1_duration5, job1_duration6, 
            job1_duration7, job1_duration9, job1_duration12))
birajnagar_job_duration_summary <-  birajnagar_job_duration %>% 
  summarise("avg job duration" = mean(na.omit(job1_duration1)))

hsam_job_duration <- job_duration %>% 
  filter(village == "Haridaskati Samsernagar") %>% 
  select(-c(relationship2, relationship3, relationship4, job1_duration3,
            job1_duration4, job1_duration5, job1_duration6, 
            job1_duration7, job1_duration9, job1_duration12))
hsam_job_duration_summary <- hsam_job_duration %>% 
  summarise("avg job duration" = mean(na.omit(job1_duration1)))

ljan_job_duration <- job_duration %>% 
  filter(village == "Lakshmi Janardanpur")%>% 
  select(-c(relationship3, relationship4, job1_duration3,
            job1_duration4, job1_duration5, job1_duration6, 
            job1_duration7, job1_duration9, job1_duration12))
ljan_job_duration_summary <- ljan_job_duration %>% 
  summarise("avg job duration" = mean(na.omit(job1_duration1)))

pargumti_job_duration <- job_duration %>% 
  filter(village == "Pargumti") %>% 
  select(-c(relationship4,
            job1_duration4, job1_duration5, job1_duration6, 
            job1_duration7, job1_duration9, job1_duration12))
pargumti_job_duration_summary <- pargumti_job_duration %>% 
  summarise("avg job duration" = mean(na.omit(job1_duration1)))

pdwar_job_duration <- job_duration %>% 
  filter(village == "Purba Dwarokapur") %>% 
  select(-c(relationship4,
            job1_duration4, job1_duration5, job1_duration6, 
            job1_duration7, job1_duration9, job1_duration12))
pdwar_job_duration_summary <- pdwar_job_duration %>% 
  summarise("avg job duration" = mean(na.omit(job1_duration1)))

sagar_job_duration <- job_duration %>% 
  filter(village == "Sagar")%>% 
  select(-c(relationship3, relationship4, job1_duration3,
            job1_duration4, job1_duration5, job1_duration6, 
            job1_duration7, job1_duration9, job1_duration12))
sagar_job_duration_summary <- sagar_job_duration %>% 
  summarise("avg job duration" = mean(na.omit(job1_duration1)))

shibpur_job_duration <- job_duration %>% 
  filter(village == "Shibpur")%>% 
  select(-c(relationship4,
            job1_duration4, job1_duration5, job1_duration6, 
            job1_duration7, job1_duration9, job1_duration12))
shibpur_job_duration_summary <- shibpur_job_duration %>% 
  summarise("avg job duration" = mean(na.omit(job1_duration1)))

job_duration_avg <- c(amrabati_job_duration_summary$`avg job duration`, beguakhali_job_duration_summary$`avg job duration`,
                      bijoynagar_job_duration_summary$`avg job duration`,birajnagar_job_duration_summary$`avg job duration`,
                      hsam_job_duration_summary$`avg job duration`,
                      ljan_job_duration_summary$`avg job duration`, pargumti_job_duration_summary$`avg job duration`,
                      pdwar_job_duration_summary$`avg job duration`, sagar_job_duration_summary$`avg job duration`,
                      shibpur_job_duration_summary$`avg job duration`)

job_duration_summary <- data.frame(villages, job_duration_avg)

```

## Plot of Average Job duration for the primary occupation of the head of household by village

```{r}
job_duration_plot <- ggplot(job_duration_summary, aes(x = villages, y = job_duration_avg, fill = villages)) +
  geom_col( fill = plasma(10, alpha = 1, begin = 0, end = 1, direction = 1)) + 
  coord_flip()+
  labs(x= "", y = "Average Job Duration [Months]")+
  ggtitle("Average Job Duration for the Head of the Household") +
  theme_classic()
job_duration_plot
```

- This graph shows the average amount of months the head of household worked at their primary occupation in the last 12 months
- Almost all villages showed the head of household working at their primary occupation for an average of at least 7 months

# *Households Below the Poverty Line*

## Across all villages

```{r}
slices_pl <- c(202, 103)
lbls_pl <- c("No", "Yes")
pct_pl <- round(slices_pl/sum(slices_pl)*100)
lbls_pl <- paste(lbls_pl, pct_pl) # add percents to labels
lbls_pl <- paste(lbls_pl,"%",sep="") # ad % to labels
pie3D(slices_pl,labels = lbls_pl, col=rainbow(length(lbls_pl)),
    main="Households That Live Below the Poverty Line (All Villages)")
```

- This pie chart shows the proportion of households that live below the poverty line across all 10 villages
- 34% of households, across all 10 villages, live below the poverty line
- (66% dont)
- Living below the poverty line means that you make below 204 rupee per week per person
- A significant amount of the Sundarbans region lives in financial poverty (more than a third)

## Households Below the Poverty Line By Village
```{r}
# Poverty stacked plot
village_pl_count_plot <- ggplot(dat_pl, aes(x= villages_2, y = values_pl, fill = Key)) + 
  geom_col(position = 'stack') + 
  labs( x= "", y = "Total Number of Households") + 
  theme_classic() + 
  ggtitle("Households That Live Below the Poverty Line") +
  coord_flip()+
  geom_text(aes(label = prop_pl_values), size = 2.5, nudge_y = -1)
village_pl_count_plot
```
-   Most villages showed around 20-30% of households below the poevrty line
-   Purba had the lowest, only 18% below the poverty line
-   Haridaskati Samserngar had more than 50% of households report to live below the poverty line

# *Household size*

## Median Household Size By Village
```{r}
hhsize <- baseline %>% 
  select(village, hhid, nb_hhmem) 
median_hhsize <- hhsize %>% 
  group_by(village) %>% 
  summarise("median" = median(nb_hhmem))
hh_size_plot <- ggplot(median_hhsize, aes(x = village, y = median, fill = village)) +
                         geom_col(fill = plasma(10, alpha = 1, begin = 0, end = 1, direction = 1)) +
  labs( x = "", y = "Median Household Size")+
  coord_flip()+
  theme_classic()
hh_size_plot
```

- This graph shows the median household size by village
- Most villages have a median household size of 4 people (including the head of household)




