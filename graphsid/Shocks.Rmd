---
title: "Shocks"
author: "Siddarth Ravikanti"
date: "6/27/2022"
output:
  pdf_document: default
  html_document: default
---

```{r}
library(dplyr)
library(ggplot2)
library(tidyverse)
library(viridis)
library(plotly)

load("~/Documents/2022-DSPG-LivDiv-/data/livdivdata.RData")
baseline <- livdiv %>%
slice(1:306,)
```

```{r}
shocks <- baseline %>% select(shk1,shk2,shk3,shk4,shk5,shk6,shk7)
shocks <- data.frame(y=unlist(shocks))
colnames(shocks) <- c('shock_nmb')
shock_labels <- c('None', 'Crop Loss', 'Loss of vegetation', 'Damage(saline water)','Forced to move(Flooding)', 'Loss of agricultural land(river erosion)','Loss of home(river erosion/cyclone)', 'Loss of livestock', 'Loss of business/shop/etc.', 'Death/health issues', 'Other')


ggplot(shocks, aes(shock_nmb)) + geom_bar(fill = "dark red") + labs(x = "", y = "Occurances" ,title = "Frequency") + theme(axis.text = element_text(size = 7)) + scale_x_discrete(breaks = c(0,1,2,3,4,5,6,7,8,9,10),labels = str_wrap(shock_labels, width = 25) ,limits = 0:10) + coord_flip()
```
As the Sundarban Region is susceptible to climate change and extreme weather events, some of the most frequent shocks include Loss of home due to river erosion/cyclones, loss of livestock, and loss of crop. These shocks can set back a household financially for many years and also disturb the livelihood of the family. The least common shocks occurring are loss of business/shop or damage by salt water. 

```{r}
shocks2 <- baseline %>% select(village, shk_count) %>% group_by(village) %>% summarize(avg_count = sum(shk_count, na.rm = TRUE)/n())

ggplot(shocks2, aes(village, avg_count, fill = village)) + geom_col() + labs(x = "", y = "No. of Shocks" ,title = "Shocks by Village", fill = "Village") + theme(axis.text.x=element_blank(),axis.ticks.x=element_blank()) + scale_fill_viridis_d() + coord_polar()

```
By breaking down all the shocks that occurred over the nine year period by village, we were able to see if there was any specific village that had a dissproportionate impact by the shocks. Since many of these villages were located close to each other, many of the natural occuring shocks impacted all of the households in a somewhat equal manner. 


```{r}
shock_year <- baseline %>% select(shk_2009_count, shk_2010_count, shk_2011_count, shk_2012_count, shk_2013_count, shk_2014_count, shk_2015_count, shk_2016_count, shk_2017_count, shk_2018_count) %>% summarize("2009" = sum(shk_2009_count), "2010" = sum(shk_2010_count), "2011" = sum(shk_2011_count), "2012" = sum(shk_2012_count), "2013" = sum(shk_2013_count), "2014" = sum(shk_2014_count), "2015" = sum(shk_2015_count), "2016" = sum(shk_2016_count),"2017" = sum(shk_2017_count), "2018" = sum(shk_2018_count))

shocks_year_long <- gather(shock_year, year, count, "2009":"2018")

ggplot(shocks_year_long, aes(year, count, fill = year)) + geom_col() + labs(x = "", y = "Number of Shocks" ,title = "Total Shocks by Year") + theme(axis.ticks.x=element_blank(), legend.position="none") + scale_fill_viridis_d() 

```
In the past decade and a half, the most devastating cyclones in the region took place in 2007,2009, 2019, 2020, and 2021. This graph does a good job showing the effect of the 2009 cyclone(Aila) and the high proportion of shocks taking place in that year as a result. Many of the households during this year had 2,3 and sometimes 4 shocks making it a devastating impact for all the households. 

```{r}
shocks_2009 <- baseline %>% select(shk_2009_type1, shk_2009_type2, shk_2009_type3, shk_2009_type4, shk_2009_type5, shk_2009_type6)
shock_labels_2009 <- c('None', 'Crop Loss', 'Loss of vegetation', 'Damage(saline water)','Forced to move(Flooding)', 'Loss of agricultural land(river erosion)','Loss of home(river erosion/cyclone)', 'Loss of livestock', 'Loss of business/shop/etc.', 'Death/health issues', 'Other')
shocks_2009 <- data.frame(y=unlist(shocks_2009))
colnames(shocks_2009) <- c('shk')

ggplot(shocks_2009, aes(shk)) + geom_bar(fill = "dark red") + labs(x = "", y = "Occurances" ,title = "Shocks for 2009") + theme(axis.text = element_text(size = 7)) + scale_x_discrete(breaks = c(0,1,2,3,4,5,6,7,8,9,10),labels = str_wrap(shock_labels_2009, width = 25) ,limits = 0:10) + coord_flip()

```

Since 2009 had almost 900 shocks out of the 1200 in the span collected, we wanted to take a further look at the type of shocks taking place during that year. Just like the total shocks over the 9 year period, Loss of home due to erosion and cyclones is the leading shock due to the cyclone Aila taking place. 

```{r}
shocks_cope <- baseline %>% select(village, shk_2009_cope) 

cope_labels <- c("Did not do anything","Unconditional help by relatives/friends","Unconditional help by local government", "Changed dietary practices involuntarily", "Changed cropping practices", "More non-farm employment", "More farm wage employment", "Household member(s) migrated", "Relied on savings", "Obtained credit", "Sold durable household assets", "Sold land/building", "Rented out land/building","Distress sales of animal stock", "Children Moved","Reduced spending on health/education","Don't know/no response")

shocks_cope$shk_2009_cope<-replace(shocks_cope$shk_2009_cope, shocks_cope$shk_2009_cope == 997, 16)

ggplot(shocks_cope, aes(shk_2009_cope, fill = village)) + geom_bar() + labs(x = "", y = "" ,title = "Type of Cope after 2009 shocks", fill = "Village") + scale_fill_viridis_d() + theme(axis.text = element_text(size = 6)) +scale_x_discrete(breaks = c(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16), labels = str_wrap(cope_labels, width = 30), limits = 0:20) + coord_flip() 


```
After the many shocks occurring in 2009, the households coped by taking steps like obtaining credit or pursuing other jobs. By far the most common cope was unconditional help by the government followed by help from friends or relatives. Often times, families did nothing and tried to "whether the storm" until times are better.  
```{r}
shock_relocation <- baseline %>% select(village, shk_2009_reloc_yn)

relocation_labels <- c("No", "Yes, for under a month", "Yes, for over a month")

ggplot(shock_relocation, aes(shk_2009_reloc_yn, fill = village)) + geom_bar() + labs(x = "", y = "No. of Households" ,title = "Relocation Status after Shock", fill = "Village") + scale_x_discrete(breaks = c(0,1,2), labels = str_wrap(relocation_labels, width = 30), limits = 0:2) + scale_fill_viridis_d()
```
Relocation is common after shocks occur in the region and often times households are relocated for less than a month. Around 80 households don't relocate after a shock and 75 households relocate for more than a month as well. 

```{r}

shock_relocation_where <- baseline %>% select(village, shk_2009_reloc1)
 
relocation_where_labels <- c("Within same village","Other village in Sundarbans","Village outside Sundarbans, within West Bengal", "Kolkata", "Other Urban area outside Sundarbans, within West Bengal","Urban area outside West Bengal")

ggplot(shock_relocation_where, aes(shk_2009_reloc1, fill = village)) + geom_bar() + labs(x = "", y = "No. of Households" ,title = "Relocation Areas", fill = "Village") + scale_x_discrete(breaks = c(1,2,3,4,5,6), labels = str_wrap(relocation_where_labels, width = 20), limits = 1:6) + scale_fill_viridis_d() + coord_flip() +  theme(axis.text = element_text(size = 8))

```
With a vast majority of households saying that they relocate for either less or more than a month, many of these households relocate to a safer place in the same village. Less frequently do the households relocate to Kolkata(the biggest city nearby) or other villages around the Sundarbans. 